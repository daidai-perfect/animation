import{l as ko,R as To,a6 as ho}from"./entry.ad32dc49.js";import{h as y,b as xo,j as bo,s as C,a as go}from"./sha256.de7acfa8.js";import{x as Bo,q as Lo,y as fo,b as K,z as to,T as Ao,C as So,V as eo,u as vo,a as Po,c as qo,p as ao}from"./pool.f9585ea2.js";import{D as e}from"./decimal.0bdeb344.js";function yo(i){const m={launchpad:y[i||"Sui"].launchpad,ido:y[i||"Sui"].ido,xcetus:y[i||"Sui"].xcetus,xcetus_dividends:y[i||"Sui"].xcetus_dividends,cetus_faucet:y[i||"Sui"].cetus_faucet,xtoken:y[i||"Sui"].xtoken,xtoken_dividends:y[i||"Sui"].xtoken_dividends,token_faucet:y[i||"Sui"].token_faucet,booster:y[i||"Sui"].booster,maker_bonus:y[i||"Sui"].maker_bonus,liquidity_stratefy:y[i||"Sui"].liquidity_stratefy,vaults:y[i||"Sui"].vaults,frams:y[i||"Sui"].frams},A={fullRpcUrl:localStorage.getItem(`${i}-currentRpclocal4`)||y[i||"Sui"].fullRpcUrl,simulationAccount:y[i||"Sui"].simulationAccount,cetus_config:y[i||"Sui"].cetus_config,clmm_pool:y[i||"Sui"].clmm_pool,integrate:y[i||"Sui"].integrate,deepbook:y[i||"Sui"].deepbook,deepbook_endpoint_v2:y[i||"Sui"].deepbook_endpoint_v2,aggregatorUrl:y[i||"Sui"].aggregatorUrl},r=new Bo(A),s=new Lo(m,r),c=xo(),D=ko(()=>c);To(()=>{D.value.address&&(r.senderAddress=D.value.address)});const O=async()=>{console.log(s,"sdk###");const t=await s.Vaults.getVaultList();return console.log("result.data:",t.data),t&&t.data||[]},I=async t=>{const l=await s.Vaults.getVault(t);return console.log(l,"vault##"),{...l,quota_based_type:fo(l.quota_based_type).full_address}},u=async t=>{if(console.log(t,"###coinType"),r.senderAddress){const l=await s.ClmmSDK.fullClient.getBalance({owner:r.senderAddress,coinType:t});return l&&l.totalBalance}else return 0},o=t=>({transactionBlock:t,options:{showEffects:!0,showEvents:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0,showBalanceChanges:!0}}),g=async t=>{const{lowerTick:l,upperTick:_,slippage:T,rewarder_coin_types:N,isOnlyA:f,isOnlyB:h,currentTickIndex:q,decimal_b:$,request_id:B,stakeProtocol:V,shouldRequestStake:U,farming_pool:F}=t;console.log(t,"params###");let a=t.fix_amount_a,n,S,p,P=q;const M=await s.ClmmSDK.Pool.getPool(t.clmm_pool);if(f||h){let d;try{d=await x({lowerTick:l,upperTick:_,curSqrtPrice:M.current_sqrt_price.toString(),fix_amount_a:t.fix_amount_a,input_amount:t.coinAmount,coinTypeA:t.coinTypeA,coinTypeB:t.coinTypeB,clmm_pool:t.clmm_pool,use_route:!0,slippage:T,request_id:B,stakeProtocol:V,shouldRequestStake:U})}catch(X){console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:139 ~ deposit ~ e:",X)}console.log(d,"swapResut##211"),d?(S=new K(d.afterSqrtPrice),n=d.fixAmountA===a?new K(to(t.coinAmount).sub(d.swapInAmount).toString()):new K(d.swapOutAmount),p={swap_amount:d.swapInAmount,a2b:a,input_amount:t.coinAmount,route_obj:d.routeObj,stakeProtocol:d.stake_protocol},a=d.fixAmountA,P=Ao.sqrtPriceX64ToTickIndex(new K(d.afterSqrtPrice))):(S=new K(t.curSqrtPrice),n=new K(t.coinAmount))}else S=t.curSqrtPrice,n=new K(t.coinAmount);let b,L,v;console.log(l,q,_,"####138"),P>=l&&P<=_?(b=So.estLiquidityAndcoinAmountFromOneAmounts(l,_,n,a,!0,T,S),L=a?n.toString():b.tokenMaxA.toString(),v=a?b.tokenMaxB.toString():n.toString()):P<l?(L=n.toNumber(),v=0):P>_&&(L=0,v=n.toNumber()),console.log({lowerTick:l,upperTick:_,vault_id:t.id,clmm_pool:t.clmm_pool,farming_pool:F,lp_token_type:t.lp_token_type,amount_a:L,amount_b:v,fix_amount_a:a,slippage:T,coinTypeA:t.coinTypeA,coinTypeB:t.coinTypeB,swapParams:p},"params171");const W=await s.Vaults.deposit({lowerTick:l,upperTick:_,vault_id:t.id,clmm_pool:t.clmm_pool,lp_token_type:t.lp_token_type,amount_a:L,amount_b:v,fix_amount_a:a,slippage:T,coinTypeA:t.coinTypeA,coinTypeB:t.coinTypeB,swapParams:p,farming_pool:F});return o(W)},w=async t=>{const{lowerTick:l,upperTick:_,coinTypeA:T,coinTypeB:N,receiveAmount:f,clmm_pool:h,lowerSqrtPrice:q,upperSqrtPrice:$,fix_amount_a:B,curSqrtPrice:V,slippage:U,rewarder_coin_types:F,id:a,liquidity:n,swapParams:S,isOnlyA:p,isOnlyB:P,sliderVal:M,positionInfo:b,maxLiquidity:L,request_id:v,farming_pool:W}=t;console.log(M,"sliderVal##");const d=await I(a),X=await r.Pool.getPool(d.pool_id);let Q,k,J,Y,oo,Z,z;const j=eo.get_share_liquidity_by_amount(d,M==100?b.balance:t.lpTokenAmount);if(console.log(f,"##receiveAmount"),p||P){try{Q=R({lowerTick:l,upperTick:_,curSqrtPrice:X.current_sqrt_price,fix_amount_a:B,receive_amount:f,coinTypeA:T,coinTypeB:N,clmm_pool:h,use_route:!0,slippage:U,removeLiquidity:M==100?j:"",maxLiquidity:L,request_id:v})}catch(G){console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:257 ~ remove ~ e:",G)}if(console.log(Q,"swapResut###"),Q){const G=eo.get_share_liquidity_by_amount(d,b.balance);k=So.getCoinAmountFromLiquidity(new K(M==100?G:Q.liquidity),new K(X.current_sqrt_price),q,$,!1),J=eo.get_protocol_fee_amount(d,k.coinA.toString()),Y=eo.get_protocol_fee_amount(d,k.coinB.toString()),oo=M==100?b.balance:eo.get_lp_amount_by_liquidity(d,Q.liquidity),Z=to(k.coinA.toString()).mul(to(1-t.slippage)),z=to(k.coinB.toString()).mul(to(1-t.slippage)),console.log(Z.toString(),"##minAmountA"),console.log(z.toString(),"##minAmountA")}}else console.log(j,"#removeLiquidity"),k=So.getCoinAmountFromLiquidity(new K(j),new K(X.current_sqrt_price),q,$,!1),console.log(k,"#coinAmountscoinAmounts"),oo=t.lpTokenAmount,Z=to(k.coinA.toString()).mul(to(1-t.slippage)),z=to(k.coinB.toString()).mul(to(1-t.slippage)),console.log(J,Y,"##protocol_fee_amount_b"),console.log(Z.toString(),"##minAmountA"),console.log(z.toString(),"##minAmountA"),console.log(t,"params###246");console.log(oo,"lpTokenAmount remove");const io={vault_id:t.id,clmm_pool:t.clmm_pool,lp_token_type:t.lp_token_type,coinTypeA:t.coinTypeA,coinTypeB:t.coinTypeB,lp_token_amount:oo,min_amount_a:bo(Z,0)||"",min_amount_b:bo(z,0)||"",rewarder_coin_types:[],slippage:t.slippage,farming_pool:W};console.log(io,"##removeParams"),(p||P)&&(io.swapParams={a2b:!B,swap_amount:Q==null?void 0:Q.swapInAmount,route_obj:Q.routeObj});const H=await s.Vaults.remove(io);return o(H)},x=async t=>{var S;const{lowerTick:l,upperTick:_,curSqrtPrice:T,fix_amount_a:N,input_amount:f,coinTypeA:h,coinTypeB:q,clmm_pool:$,slippage:B,decimals:V,request_id:U,stakeProtocol:F,shouldRequestStake:a}=t;console.log(t,"params###");let n;try{if(n=await s.Vaults.calculateDepositSwapAmount({lowerTick:l,upperTick:_,curSqrtPrice:T,fix_amount_a:N,input_amount:f,coinTypeA:h,coinTypeB:q,clmm_pool:$,use_route:!0,priceSplitPoint:B,request_id:U,stakeProtocol:F,shouldRequestStake:a},!0),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:365 ~ calculateDepositSwapAmount ~ swapResut:",n),(S=n==null?void 0:n.routeObj)!=null&&S.isTimeout)throw new Error("router timeout")}catch(p){if(console.log(p,"calculateDepositSwapAmount error"),(String(p)=="Error: route unavailable"||String(p)=="Error: router timeout")&&(n=await s.Vaults.calculateDepositSwapAmount({lowerTick:l,upperTick:_,curSqrtPrice:T,fix_amount_a:N,input_amount:f,coinTypeA:h,coinTypeB:q,clmm_pool:$,use_route:!1,priceSplitPoint:B,request_id:U,stakeProtocol:F,shouldRequestStake:a},!0),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:387 ~ calculateDepositSwapAmount ~ swapResut:",n)),String(p)=="Error: HaedalStakeSuiAmountError")return"HaedalStakeSuiAmountError"}if(console.log(n,"##swapResut"),n){console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:384 ~ calculateDepositSwapAmount ~ swapResut.swapOutAmount:",n.swapOutAmount);const p=new e(n.swapOutAmount);return{...n,swapOutAmountLimit:C(p.sub(p.mul(B)).toNumber(),V)}}return n},R=async t=>{var S;const{lowerTick:l,upperTick:_,curSqrtPrice:T,fix_amount_a:N,receiveAmount:f,coinTypeA:h,coinTypeB:q,clmm_pool:$,slippage:B,decimals:V,liquidity:U,maxLiquidity:F,request_id:a}=t;console.log(t,"params###");let n;try{if(n=await s.Vaults.calculateRemoveSwapAmount({lowerTick:l,upperTick:_,curSqrtPrice:T,fix_amount_a:N,receive_amount:f,coinTypeA:h,coinTypeB:q,clmm_pool:$,use_route:!0,priceSplitPoint:B,removeLiquidity:U,maxLiquidity:F,request_id:a}),(S=n==null?void 0:n.routeObj)!=null&&S.isTimeout)throw new Error("router timeout")}catch(p){(String(p)=="Error: route unavailable"||String(p)=="Error: router timeout")&&(console.log(p,"e432"),n=await s.Vaults.calculateRemoveSwapAmount({lowerTick:l,upperTick:_,curSqrtPrice:T,fix_amount_a:N,receive_amount:f,coinTypeA:h,coinTypeB:q,clmm_pool:$,use_route:!1,priceSplitPoint:B,removeLiquidity:U,maxLiquidity:F,request_id:a}))}if(console.log(n,"###swapResut calculateRemoveSwapAmount"),n){const p=new e(n.swapOutAmount);return console.log(p.toNumber(),"swapOutAmount.toNumber()"),{...n,swapOutAmountLimit:C(p.sub(p.mul(B)).toNumber(),V)}}return n};return{getAutoPools:O,getLpBalance:u,getVault:async t=>{const l=await s.Vaults.getVault(t);return console.log(l,"vault##292"),l},deposit:g,remove:w,getAutoPool:I,calculateDepositSwapAmount:x,calculateRemoveSwapAmount:R}}const Uo=ho("autoPool",{state:()=>({autoPoolList:[],autoPoolObj:{},positionInfoObj:{},positionInfoList:[],positionUSDObj:{},apyObj:{},currentAutoPoolStatus:"STATUS_RUNNING",slippage:localStorage.getItem("cetus-auto-slippage")||"0.1",autoPoolLoading:!0}),getters:{getPoolStore(){return vo()}},actions:{async getAutoPoolList(){var I;const m=await yo("Sui").getAutoPools();console.log("ðŸš€ðŸš€ðŸš€ ~ file: autoPool.ts:35 ~ getAutoPoolList ~ list:",m),console.log(m,"list###");const A=this.getPoolStore,r=y.Sui.vaultFilter;let s;try{s=await fetch(`${y.Sui.api}/v2/sui/auto_pools`).then(u=>u.json())}catch{s=[]}console.log(s==null?void 0:s.data,"data##37");const c=((I=s==null?void 0:s.data)==null?void 0:I.pools)||[],D=c&&c.length>0?m.filter(u=>c.some(o=>o.object_id===u.id)):m;console.log(D,"##openPoolList");const O=(r?D:m).map(u=>{var w,x,R;const o=A.poolConfigObj[u.pool_id];console.log("ðŸš€ðŸš€ðŸš€ ~ file: autoPool.ts:55 ~ autoPoolList ~ poolStore.poolConfigObj:",A.poolConfigObj),console.log("autoPoolList map",u,o);const g=[o!=null&&o.needReverse?o==null?void 0:o.coin_b_address:o==null?void 0:o.coin_a_address,o!=null&&o.needReverse?o==null?void 0:o.coin_a_address:o==null?void 0:o.coin_b_address];return(w=o==null?void 0:o.rewarderInfo)==null||w.forEach(E=>{E.emissionsEveryDay>0&&g.push(E.coinAddress)}),(R=(x=o==null?void 0:o.stable_farming)==null?void 0:x.stable_rewarder)==null||R.forEach(E=>{E.amount_second>0&&g.push(E.coin)}),{...o,token_a:o.coinA,token_b:o.coinB,id:u.id,lp_token_type:u.lp_token_type,autoPoolPositionInfo:u.position,is_pause:u.is_pause,total_supply:u.total_supply,liquidity:u.liquidity,protocol_fee_rate:u.protocol_fee_rate,max_quota:u.max_quota,stakeProtocol:u.stake_protocol,quota_based_type:fo(u.quota_based_type).full_address,supportHaedalStake:!!u.stake_protocol,isTokenA:o!=null&&o.needReverse?(o==null?void 0:o.coin_b_address)=="0000000000000000000000000000000000000000000000000000000000000002::sui::SUI":(o==null?void 0:o.coin_a_address)=="0000000000000000000000000000000000000000000000000000000000000002::sui::SUI",rewardList:Array.from(new Set(g))}});this.autoPoolList=O,this.autoPoolObj=Object.fromEntries(O.map((u,o)=>[u.address,u])),this.getMyAutoPoolPosition(),console.log(O,"##autoPoolList")},async getMyAutoPoolPosition(){var c,D,O,I;const i=yo("Sui"),m=this.autoPoolList,A=Po("Sui"),r=[],{RATES:s}=this.getPoolStore;for(let u=0;u<m.length;u++){const o=m[u];console.log(o,"poolINfo###");const g=await A.getPool(o.address||o.autoPoolPositionInfo.clmm_pool_id),w=await i.getAutoPool(o.id),x=await i.getLpBalance(m[u].lp_token_type);console.log(x,"balance##");const R=(await A.getTokenListByCoinType([m[u].lp_token_type]))[0];console.log(R,"lpInfo##");const E=((c=s[o.coinA.address])==null?void 0:c.price)||0,t=((D=s[o.coinB.address])==null?void 0:D.price)||0,l=o.autoPoolPositionInfo.tick_lower_index,_=o.autoPoolPositionInfo.tick_upper_index,T=Number(x)>0?eo.get_share_liquidity_by_amount({liquidity:o==null?void 0:o.liquidity,total_supply:o==null?void 0:o.total_supply},x):0,N={tick_lower_index:l,tick_upper_index:_,current_sqrt_price:g==null?void 0:g.current_sqrt_price,liquidity:T};console.log(o,"poolInfo##94");const f=await A.getCoinAmountFromLiquidity({pool:{...o,current_sqrt_price:g==null?void 0:g.current_sqrt_price},position:N,roundUp:!1});console.log(f,"##amountInfo");const h=f.coinaAmount,q=f.coinbAmount,$=h,B=q,V=o.coinA.decimals,U=o.coinB.decimals,F=A.TickMath.tickIndexToPrice(Number(l),V,U).toString(),a=A.TickMath.tickIndexToPrice(Number(_),V,U).toString(),n=h>0?new e(E).mul(new e(h)).toNumber():0,S=q>0?new e(t).mul(new e(q)).toNumber():0,p=n>0&&n<.01?"<$0.01":`$${go(C(n,2))}`,P=S>0&&S<.01?"<$0.01":`$${go(C(S,2))}`,M=Ao.sqrtPriceX64ToPrice(g.current_sqrt_price,V,U),b=await A.getCoinAmountFromLiquidity({pool:{...o,tick_lower_index:l,tick_upper_index:_,current_sqrt_price:g==null?void 0:g.current_sqrt_price},position:{...N,liquidity:o.liquidity},roundUp:!1}),L=new e(b.coinaAmount).toNumber(),v=new e(b.coinbAmount).toNumber();console.log(L,v,M.toString(),"###116");const W=C(new e(L).mul(new e(E)).toNumber(),2),d=C(new e(v).mul(new e(t)).toNumber(),2);console.log(g,"newPool##"),console.log(L,v,E,t,Number(W)+Number(d),"###poolCoinBNum");const{ratioA:X,ratioB:Q}=eo.calculateDepositRatio(l,_,new K.BN(g==null?void 0:g.current_sqrt_price));console.log(X,Q.toString(),"###139");const k=X.mul(100).toNumber().toFixed(0),J=100-Number(k);console.log(L,v,k,J,"###147");let Y=0;Number(x)>0&&(Y=new e(x).div(Math.pow(10,R.decimals)));const oo=new e(n).add(new e(S)).toNumber(),Z=E&&t?oo>0&&oo<.01?"<0.01":C(new e(n).add(new e(S)).toString(),2):"--",z=w.total_supply;let j=0;Y>0&&z>0&&(j=new e(Y).mul(Math.pow(10,R.decimals)).div(new e(z)).mul(100).toNumber()),console.log(j,"##myShare");const io=new e(1).div(Math.pow(10,o.decimals)).toNumber();let H=0;if(j>1)H=C(j,2);else if(j>0&&j<io)H=`<${io}`;else if(j==0)H=0;else{const ro=qo(j),wo=ro==-1?2:ro+2;H=C(j,wo)}console.log(x,Y.toString(),"###balance");const G=(await A.getTokenListByCoinType([o.quota_based_type]))[0],po=ao(o.max_quota,G.decimals);console.log(o.quota_based_type,G,po,"##quoteCoinInfo");const so=G.address==o.coin_b_address,co=so?new e(b.coinaAmount).mul(o.price).add(b.coinbAmount):new e(b.coinaAmount).mul(1/o.price).add(b.coinbAmount),mo=((O=s[G.address])==null?void 0:O.price)||0,no=co.mul(new e(mo)).toNumber();console.log(so,no,"#isQuotaCoin");const uo=po,_o=so?new e(b.coinaAmount).mul(o.price).add(b.coinbAmount):new e(b.coinaAmount).mul(1/o.price).add(b.coinbAmount),lo=new e(uo).sub(_o).mul(t).toNumber();console.log(lo,"remainingTokenUSD##"),console.log(co.toNumber(),"#poolTokenNum"),this.positionInfoObj[o.id]={tick_lower_index:l,tick_upper_index:_,current_sqrt_price:g.current_sqrt_price,myLiquidity:ao(x,R.decimals),amountA:$,amountB:B,...o,lpInfo:R,myAmountAUSD:p,myAmountBUSD:P,myLiquidityUSD:Z,myShare:H,minPrice:F,maxPrice:a,poolCoinARatio:k,poolCoinBRatio:J,poolCoinANum:L,poolCoinBNum:v,poolCoinAUSD:W,poolCoinBUSD:d,quoteUSD:uo,poolUSD:no,balance:x,quoteCoinInfo:G,remainingTokenUSD:lo,currentDeposit:no,positionLiquidity:T,total_supply:w.total_supply},r.push({tick_lower_index:l,tick_upper_index:_,current_sqrt_price:(I=o==null?void 0:o.object)==null?void 0:I.current_sqrt_price,myLiquidity:ao(x,R.decimals),amountA:$,amountB:B,...o,lpInfo:R,myAmountAUSD:p,myAmountBUSD:P,myLiquidityUSD:Z,myShare:H,minPrice:F,maxPrice:a,poolCoinARatio:k,poolCoinBRatio:J,poolCoinANum:L,poolCoinBNum:v,poolCoinAUSD:W,poolCoinBUSD:d,quoteUSD:uo,poolUSD:no,balance:x,total_supply:w.total_supply})}this.positionInfoList=r,console.log(this.positionInfoObj,"this.positionInfoObj###"),console.log(this.positionInfoList,"###this.positionInfoList")},async updatePositionItem(i){var so,co,mo,no,uo,_o,lo;const m=yo("Sui"),A=Po("Sui"),r=await m.getAutoPool(i);console.log("ðŸš€ðŸš€ðŸš€ ~ file: autoPool.ts:318 ~ updatePositionItem ~ newPoolInfo:",r);const s=await A.getPool(r.address||r.position.clmm_pool_id);console.log("newPoolInfo:",r),console.log("newPool:",s),console.log("this.positionInfoObj[id]:",this.positionInfoObj[i]);const c={...this.positionInfoObj[i],autoPoolPositionInfo:r.position,...s},D=await m.getLpBalance(c.lp_token_type);console.log(D,"updatePositionItem lp balance");const O=(await A.getTokenListByCoinType([c.lp_token_type]))[0];console.log(D,"###balance updatePositionItem");const I=c.autoPoolPositionInfo.tick_lower_index,u=c.autoPoolPositionInfo.tick_upper_index;let o;r.total_supply==0?o=0:o=eo.get_share_liquidity_by_amount(r,String(D)),console.log(o,"##liquidity");const g={tick_lower_index:I,tick_upper_index:u,current_sqrt_price:s.current_sqrt_price,liquidity:o},w=A.getCoinAmountFromLiquidity({pool:{current_sqrt_price:s.current_sqrt_price,...c},position:g,roundUp:!1}),x=w.coinaAmount,R=w.coinbAmount,{RATES:E}=this.getPoolStore,t=r.total_supply,l=Ao.sqrtPriceX64ToPrice(s.current_sqrt_price,(so=c==null?void 0:c.coinA)==null?void 0:so.decimals,(co=c==null?void 0:c.coinB)==null?void 0:co.decimals),_=2,T=2,N=((no=E[(mo=c==null?void 0:c.coinA)==null?void 0:mo.address])==null?void 0:no.price)||0,f=((_o=E[(uo=c==null?void 0:c.coinB)==null?void 0:uo.address])==null?void 0:_o.price)||0,h=(w==null?void 0:w.coinaAmount)>0?new e(N).mul(new e(w==null?void 0:w.coinaAmount)).toNumber():0,q=(w==null?void 0:w.coinbAmount)>0?new e(f).mul(new e(w==null?void 0:w.coinbAmount)).toNumber():0,$=h>0&&h<.01?"<$0.01":`$${go(C(h,2))}`,B=q>0&&q<.01?"<$0.01":`$${go(C(q,2))}`;let V=new e(0);Number(D)>0&&(V=new e(D).div(Math.pow(10,O==null?void 0:O.decimals)),console.log("ðŸš€ðŸš€ðŸš€ ~ file: autoPool.ts:379 ~ updatePositionItem ~ myLiquidity:",V.toString()));const U=new e(h).add(new e(q)).toNumber(),F=N&&f?U>0&&U<.01?"<0.01":C(new e(h).add(new e(q)).toString(),2):"--";let a=0;V.toNumber()>0&&t>0&&(a=new e(V).mul(Math.pow(10,O.decimals)).div(new e(t)).mul(100).toNumber()),console.log(a,"##myShare");const n=new e(1).div(Math.pow(10,c.decimals)).toNumber();let S=0;if(a>1)S=C(a,2);else if(a>0&&a<n)S=`<${n}`;else if(a==0)S=0;else{const ro=qo(a),wo=ro==-1?2:ro+2;S=C(a,wo)}const p=Ao.sqrtPriceX64ToPrice(s.current_sqrt_price,_,T),P=await A.getCoinAmountFromLiquidity({pool:{...c,tick_lower_index:I,tick_upper_index:u,current_sqrt_price:s==null?void 0:s.current_sqrt_price},position:{...g,liquidity:r.liquidity},roundUp:!1}),M=new e(P.coinaAmount).toNumber(),b=new e(P.coinbAmount).toNumber();console.log(M,b,p.toString(),"###116");const L=C(new e(M).mul(new e(N)).toNumber(),2),v=C(new e(b).mul(new e(f)).toNumber(),2);console.log(s,"newPool##"),console.log(M,b,N,f,Number(L)+Number(v),"###poolCoinBNum");const{ratioA:W,ratioB:d}=eo.calculateDepositRatio(I,u,new K.BN(s==null?void 0:s.current_sqrt_price));console.log(W,d.toString(),"###139");const X=W.mul(100).toNumber().toFixed(0),Q=100-Number(X),k=(await A.getTokenListByCoinType([r.quota_based_type]))[0],J=ao(r.max_quota,k.decimals);console.log(r.quota_based_type,k,J,"##quoteCoinInfo");const Y=k.address==c.coin_b_address,oo=Y?new e(P.coinaAmount).mul(c.price).add(P.coinbAmount):new e(P.coinaAmount).mul(1/c.price).add(P.coinbAmount),Z=((lo=E[k.address])==null?void 0:lo.price)||0,z=oo.mul(new e(Z)).toNumber(),j=J,io=Y?new e(P.coinaAmount).mul(c.price).add(P.coinbAmount):new e(P.coinaAmount).mul(1/c.price).add(P.coinbAmount),H=new e(j).sub(io).mul(f).toNumber();console.log(H,"remainingTokenUSD##");const G=A.TickMath.tickIndexToPrice(Number(I),_,T).toString(),po=A.TickMath.tickIndexToPrice(Number(u),_,T).toString();this.positionInfoObj[i]={...c,tick_lower_index:I,tick_upper_index:u,current_sqrt_price:s.current_sqrt_price,myLiquidity:ao(D,O==null?void 0:O.decimals),amountA:x,amountB:R,myShare:S,myAmountAUSD:$,myAmountBUSD:B,myLiquidityUSD:F,poolCoinARatio:X,poolCoinBRatio:Q,poolCoinANum:M,poolCoinBNum:b,poolCoinAUSD:L,poolCoinBUSD:v,quoteUSD:j,balance:D,price:l,quoteCoinInfo:k,remainingTokenUSD:H,currentDeposit:z,poolUSD:z,positionLiquidity:o,liquidity:r==null?void 0:r.liquidity,minPrice:G,maxPrice:po,total_supply:r.total_supply},this.autoPoolLoading=!1,console.log(this.positionInfoObj[i],"###this.positionInfoObj[id]")},async getAutoPoolAPY(){try{const{data:i}=await fetch(`${y.Sui.api}/v2/sui/auto_pools`).then(m=>m.json());i&&i.pools&&i.pools.length>0&&(this.apyObj=Object.fromEntries(i.pools.map((m,A)=>[m.object_id,{...m,apr:m.apr.replace("%","")>0&&m.apr.replace("%","")<.01?"<0.01%":C(m.apr.replace("%",""),2)+"%",resultApr:m.apr.replace("%","")}])),console.log(this.apyObj,"data##"))}catch{this.apyObj={}}},async getVault(i,m){const A=yo("Sui");m||(this.autoPoolLoading=!0);const{status:r}=await A.getVault(i);this.currentAutoPoolStatus=r,this.updatePositionItem(i),console.log(r,"status##")},setSlippage(i){console.log(i,"slippage##"),this.slippage=i,localStorage.setItem("cetus-auto-slippage",i)},logout(){this.getMyAutoPoolPosition(),this.positionUSDObj={}}}});export{yo as a,Uo as u};
