import{m as ho,W as Lo,a0 as Bo}from"./entry.0d91eea8.js";import{e as w,Z as xo,H as vo,a as Do,R as ko,o as H,a4 as to,T as wo,K as So,a5 as eo,w as bo,s as O,u as Co,M as Po,c as qo,h as yo,a6 as fo,p as po}from"./pool.8ef3a10d.js";import{D as e}from"./decimal.0bdeb344.js";function Ao(i){const A={launchpad:w[i||"Sui"].launchpad,ido:w[i||"Sui"].ido,xcetus:w[i||"Sui"].xcetus,xcetus_dividends:w[i||"Sui"].xcetus_dividends,cetus_faucet:w[i||"Sui"].cetus_faucet,xtoken:w[i||"Sui"].xtoken,xtoken_dividends:w[i||"Sui"].xtoken_dividends,token_faucet:w[i||"Sui"].token_faucet,booster:w[i||"Sui"].booster,maker_bonus:w[i||"Sui"].maker_bonus,liquidity_stratefy:w[i||"Sui"].liquidity_stratefy,vaults:w[i||"Sui"].vaults,frams:w[i||"Sui"].frams},T={fullRpcUrl:localStorage.getItem(`${i}-currentRpclocal4`)||w[i||"Sui"].fullRpcUrl,simulationAccount:w[i||"Sui"].simulationAccount,cetus_config:w[i||"Sui"].cetus_config,clmm_pool:w[i||"Sui"].clmm_pool,integrate:w[i||"Sui"].integrate,deepbook:w[i||"Sui"].deepbook,deepbook_endpoint_v2:w[i||"Sui"].deepbook_endpoint_v2,aggregatorUrl:w[i||"Sui"].aggregatorUrl},c=new xo(T),u=new vo(A,c),r=Do(),U=ho(()=>r);Lo(()=>{U.value.address&&(c.senderAddress=U.value.address)});const D=async()=>{console.log(u,"sdk###");const o=await u.Vaults.getVaultList();return console.log("result.data:",o.data),o&&o.data||[]},I=async o=>{const l=await u.Vaults.getVault(o);return console.log(l,"vault##"),{...l,quota_based_type:ko(l.quota_based_type).full_address}},p=async o=>{if(console.log(o,"###coinType"),c.senderAddress){const l=await u.ClmmSDK.fullClient.getBalance({owner:c.senderAddress,coinType:o});return l&&l.totalBalance}else return 0},t=o=>({transactionBlock:o,options:{showEffects:!0,showEvents:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0,showBalanceChanges:!0}}),n=async o=>{const{lowerTick:l,upperTick:m,slippage:_,rewarder_coin_types:B,isOnlyA:f,isOnlyB:k,currentTickIndex:b,decimal_b:N,request_id:h,stakeProtocol:M,shouldRequestStake:x,farming_pool:R}=o;console.log(o,"params###");let d=o.fix_amount_a,s,S,g,P=b;const j=await u.ClmmSDK.Pool.getPool(o.clmm_pool);if(f||k){let y;try{y=await z({lowerTick:l,upperTick:m,curSqrtPrice:j.current_sqrt_price.toString(),fix_amount_a:o.fix_amount_a,input_amount:o.coinAmount,coinTypeA:o.coinTypeA,coinTypeB:o.coinTypeB,clmm_pool:o.clmm_pool,use_route:!0,slippage:_,request_id:h,stakeProtocol:M,shouldRequestStake:x})}catch(Q){console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:139 ~ deposit ~ e:",Q)}console.log(y,"swapResut##211"),y?(S=new H(y.afterSqrtPrice),s=y.fixAmountA===d?new H(to(o.coinAmount).sub(y.swapInAmount).toString()):new H(y.swapOutAmount),g={swap_amount:y.swapInAmount,a2b:d,input_amount:o.coinAmount,route_obj:y.routeObj,stakeProtocol:y.stake_protocol},d=y.fixAmountA,P=wo.sqrtPriceX64ToTickIndex(new H(y.afterSqrtPrice))):(S=new H(o.curSqrtPrice),s=new H(o.coinAmount))}else S=o.curSqrtPrice,s=new H(o.coinAmount);let $,q,v;console.log(l,b,m,"####138"),P>=l&&P<=m?($=So.estLiquidityAndcoinAmountFromOneAmounts(l,m,s,d,!0,_,S),q=d?s.toString():$.tokenMaxA.toString(),v=d?$.tokenMaxB.toString():s.toString()):P<l?(q=s.toNumber(),v=0):P>m&&(q=0,v=s.toNumber()),console.log({lowerTick:l,upperTick:m,vault_id:o.id,clmm_pool:o.clmm_pool,farming_pool:R,lp_token_type:o.lp_token_type,amount_a:q,amount_b:v,fix_amount_a:d,slippage:_,coinTypeA:o.coinTypeA,coinTypeB:o.coinTypeB,swapParams:g},"params171");const K=await u.Vaults.deposit({lowerTick:l,upperTick:m,vault_id:o.id,clmm_pool:o.clmm_pool,lp_token_type:o.lp_token_type,amount_a:q,amount_b:v,fix_amount_a:d,slippage:_,coinTypeA:o.coinTypeA,coinTypeB:o.coinTypeB,swapParams:g,farming_pool:R});return t(K)},a=async o=>{const{lowerTick:l,upperTick:m,coinTypeA:_,coinTypeB:B,receiveAmount:f,clmm_pool:k,lowerSqrtPrice:b,upperSqrtPrice:N,fix_amount_a:h,curSqrtPrice:M,slippage:x,rewarder_coin_types:R,id:d,liquidity:s,swapParams:S,isOnlyA:g,isOnlyB:P,sliderVal:j,positionInfo:$,maxLiquidity:q,request_id:v,farming_pool:K}=o;console.log(j,"sliderVal##");const y=await I(d),Q=await c.Pool.getPool(y.pool_id);let F,C,G,oo,W,Y,Z;const J=eo.get_share_liquidity_by_amount(y,j==100?$.balance:o.lpTokenAmount);if(console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:237 ~ remove ~ removeLiquidity:",{lowerTick:l,upperTick:m,curSqrtPrice:Q.current_sqrt_price,fix_amount_a:h,receive_amount:f,coinTypeA:_,coinTypeB:B,clmm_pool:k,use_route:!0,slippage:x,removeLiquidity:j==100?J:"",maxLiquidity:q,request_id:v}),g||P){try{F=await L({lowerTick:l,upperTick:m,curSqrtPrice:Q.current_sqrt_price,fix_amount_a:h,receiveAmount:f,coinTypeA:_,coinTypeB:B,clmm_pool:k,use_route:!0,slippage:x,liquidity:j==100?J:"",maxLiquidity:q,request_id:v})}catch(X){console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:257 ~ remove ~ e:",X)}if(console.log(F,"swapResut###"),F){const X=eo.get_share_liquidity_by_amount(y,$.balance);C=So.getCoinAmountFromLiquidity(new H(j==100?X:F.liquidity),new H(Q.current_sqrt_price),b,N,!1),G=eo.get_protocol_fee_amount(y,C.coinA.toString()),oo=eo.get_protocol_fee_amount(y,C.coinB.toString()),W=j==100?$.balance:eo.get_lp_amount_by_liquidity(y,F.liquidity),Y=to(C.coinA.toString()).mul(to(1-o.slippage)),Z=to(C.coinB.toString()).mul(to(1-o.slippage)),console.log(Y.toString(),"##minAmountA"),console.log(Z.toString(),"##minAmountA")}}else console.log(J,"#removeLiquidity"),C=So.getCoinAmountFromLiquidity(new H(J),new H(Q.current_sqrt_price),b,N,!1),console.log(C,"#coinAmountscoinAmounts"),W=o.lpTokenAmount,Y=to(C.coinA.toString()).mul(to(1-o.slippage)),Z=to(C.coinB.toString()).mul(to(1-o.slippage)),console.log(G,oo,"##protocol_fee_amount_b"),console.log(Y.toString(),"##minAmountA"),console.log(Z.toString(),"##minAmountA"),console.log(o,"params###246");console.log(W,"lpTokenAmount remove");const V={vault_id:o.id,clmm_pool:o.clmm_pool,lp_token_type:o.lp_token_type,coinTypeA:o.coinTypeA,coinTypeB:o.coinTypeB,lp_token_amount:W,min_amount_a:bo(Y,0)||"",min_amount_b:bo(Z,0)||"",rewarder_coin_types:[],slippage:o.slippage,farming_pool:K};console.log(V,"##removeParams"),(g||P)&&(V.swapParams={a2b:!h,swap_amount:F==null?void 0:F.swapInAmount,route_obj:F.routeObj});const io=await u.Vaults.remove(V);return t(io)},z=async o=>{var S;const{lowerTick:l,upperTick:m,curSqrtPrice:_,fix_amount_a:B,input_amount:f,coinTypeA:k,coinTypeB:b,clmm_pool:N,slippage:h,decimals:M,request_id:x,stakeProtocol:R,shouldRequestStake:d}=o;console.log(o,"params###");let s;try{if(s=await u.Vaults.calculateDepositSwapAmount({lowerTick:l,upperTick:m,curSqrtPrice:_,fix_amount_a:B,input_amount:f,coinTypeA:k,coinTypeB:b,clmm_pool:N,use_route:!0,priceSplitPoint:h,request_id:x,stakeProtocol:R,shouldRequestStake:d},!0),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:365 ~ calculateDepositSwapAmount ~ swapResut:",s),(S=s==null?void 0:s.routeObj)!=null&&S.isTimeout)throw new Error("router timeout")}catch(g){if(console.log(g,"calculateDepositSwapAmount error"),(String(g)=="Error: route unavailable"||String(g)=="Error: router timeout")&&(s=await u.Vaults.calculateDepositSwapAmount({lowerTick:l,upperTick:m,curSqrtPrice:_,fix_amount_a:B,input_amount:f,coinTypeA:k,coinTypeB:b,clmm_pool:N,use_route:!1,priceSplitPoint:h,request_id:x,stakeProtocol:R,shouldRequestStake:d},!0),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:387 ~ calculateDepositSwapAmount ~ swapResut:",s)),String(g)=="Error: HaedalStakeSuiAmountError")return"HaedalStakeSuiAmountError"}if(console.log(s,"##swapResut"),s){console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:384 ~ calculateDepositSwapAmount ~ swapResut.swapOutAmount:",s.swapOutAmount);const g=new e(s.swapOutAmount);return{...s,swapOutAmountLimit:O(g.sub(g.mul(h)).toNumber(),M)}}return s},L=async o=>{var S;const{lowerTick:l,upperTick:m,curSqrtPrice:_,fix_amount_a:B,receiveAmount:f,coinTypeA:k,coinTypeB:b,clmm_pool:N,slippage:h,decimals:M,liquidity:x,maxLiquidity:R,request_id:d}=o;console.log({lowerTick:l,upperTick:m,curSqrtPrice:_.toString(),fix_amount_a:B,receive_amount:f,coinTypeA:k,coinTypeB:b,clmm_pool:N,use_route:!0,priceSplitPoint:h,removeLiquidity:x,maxLiquidity:R,request_id:d},"ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:415 ~ calculateRemoveSwapAmount ~ calculateRemoveSwapAmount");let s;try{if(s=await u.Vaults.calculateRemoveSwapAmount({lowerTick:l,upperTick:m,curSqrtPrice:_,fix_amount_a:B,receive_amount:f,coinTypeA:k,coinTypeB:b,clmm_pool:N,use_route:!0,priceSplitPoint:h,removeLiquidity:x,maxLiquidity:R,request_id:d}),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAutoPool.ts:426 ~ calculateRemoveSwapAmount ~ swapResut:",s,f),(S=s==null?void 0:s.routeObj)!=null&&S.isTimeout)throw new Error("router timeout")}catch(g){(String(g)=="Error: route unavailable"||String(g)=="Error: router timeout")&&(console.log(g,"e432"),s=await u.Vaults.calculateRemoveSwapAmount({lowerTick:l,upperTick:m,curSqrtPrice:_,fix_amount_a:B,receive_amount:f,coinTypeA:k,coinTypeB:b,clmm_pool:N,use_route:!1,priceSplitPoint:h,removeLiquidity:x,maxLiquidity:R,request_id:d}))}if(console.log(s,"###swapResut calculateRemoveSwapAmount"),s){const g=new e(s.swapOutAmount);return{...s,swapOutAmountLimit:O(g.sub(g.mul(h)).toNumber(),M)}}return s};return{getAutoPools:D,getLpBalance:p,getVault:async o=>{const l=await u.Vaults.getVault(o);return console.log(l,"vault##292"),l},deposit:n,remove:a,getAutoPool:I,calculateDepositSwapAmount:z,calculateRemoveSwapAmount:L}}const Ro=Bo("autoPool",{state:()=>({autoPoolList:[],autoPoolObj:{},positionInfoObj:{},positionInfoList:[],positionUSDObj:{},apyObj:{},currentAutoPoolStatus:"STATUS_RUNNING",slippage:localStorage.getItem("cetus-auto-slippage")||"0.1",autoPoolLoading:!0}),getters:{getPoolStore(){return Co()}},actions:{async getAutoPoolList(){var I;const A=await Ao("Sui").getAutoPools();console.log("ðŸš€ðŸš€ðŸš€ ~ file: autoPool.ts:35 ~ getAutoPoolList ~ list:",A),console.log(A,"list###");const T=this.getPoolStore,c=w.Sui.vaultFilter;let u;try{u=await fetch(`${w.Sui.api}/v2/sui/auto_pools`).then(p=>p.json())}catch{u=[]}console.log(u==null?void 0:u.data,"data##37");const r=((I=u==null?void 0:u.data)==null?void 0:I.pools)||[],U=r&&r.length>0?A.filter(p=>r.some(t=>t.object_id===p.id)):A;console.log(U,"##openPoolList");const D=(c?U:A).map(p=>{var a,z,L,E,o,l,m;const t=T.poolConfigObj[p.pool_id];console.log("ðŸš€ðŸš€ðŸš€ ~ file: autoPool.ts:55 ~ autoPoolList ~ poolStore.poolConfigObj:",T.poolConfigObj),console.log("autoPoolList map",p,t);const n=[t!=null&&t.needReverse?(z=t==null?void 0:t.coinB)==null?void 0:z.address:(a=t==null?void 0:t.coinA)==null?void 0:a.address,t!=null&&t.needReverse?(E=t==null?void 0:t.coinA)==null?void 0:E.address:(L=t==null?void 0:t.coinB)==null?void 0:L.address];return(o=t==null?void 0:t.rewarderInfo)==null||o.forEach(_=>{_.emissionsEveryDay>0&&n.push(Po(_.coinAddress))}),(m=(l=t==null?void 0:t.stable_farming)==null?void 0:l.stable_rewarder)==null||m.forEach(_=>{_.amount_second>0&&n.push(Po(_.coin))}),{...t,token_a:t.coinA,token_b:t.coinB,id:p.id,lp_token_type:p.lp_token_type,autoPoolPositionInfo:p.position,is_pause:p.is_pause,total_supply:p.total_supply,liquidity:p.liquidity,protocol_fee_rate:p.protocol_fee_rate,max_quota:p.max_quota,stakeProtocol:p.stake_protocol,quota_based_type:ko(p.quota_based_type).full_address,supportHaedalStake:!!p.stake_protocol,isTokenA:t!=null&&t.needReverse?(t==null?void 0:t.coin_b_address)=="0000000000000000000000000000000000000000000000000000000000000002::sui::SUI":(t==null?void 0:t.coin_a_address)=="0000000000000000000000000000000000000000000000000000000000000002::sui::SUI",rewardList:Array.from(new Set(n))}});this.autoPoolObj=Object.fromEntries(D.map((p,t)=>[p.address,p])),this.autoPoolList=D,this.getMyAutoPoolPosition(D),console.log(D,"##autoPoolList")},async getMyAutoPoolPosition(i){var U,D,I,p;const A=Ao("Sui"),T=i||this.autoPoolList;console.log("ðŸš€ðŸš€ðŸš€ ~ file: autoPool.ts:99 ~ getMyAutoPoolPosition ~ this.autoPoolList:",this.autoPoolList);const c=qo("Sui"),u=[],{RATES:r}=this.getPoolStore;for(let t=0;t<T.length;t++){const n=T[t];console.log(n,"poolINfo###");const a=await c.getPool(n.address||n.autoPoolPositionInfo.clmm_pool_id),z=await A.getAutoPool(n.id),L=await A.getLpBalance(T[t].lp_token_type);console.log(L,"balance##");const E=(await c.getTokenListByCoinType([T[t].lp_token_type]))[0];console.log(E,"lpInfo##");const o=((U=r[n.coinA.address])==null?void 0:U.price)||0,l=((D=r[n.coinB.address])==null?void 0:D.price)||0,m=n.autoPoolPositionInfo.tick_lower_index,_=n.autoPoolPositionInfo.tick_upper_index,B=Number(L)>0?eo.get_share_liquidity_by_amount({liquidity:n==null?void 0:n.liquidity,total_supply:n==null?void 0:n.total_supply},L):0,f={tick_lower_index:m,tick_upper_index:_,current_sqrt_price:a==null?void 0:a.current_sqrt_price,liquidity:B};console.log(n,"poolInfo##94");const k=await c.getCoinAmountFromLiquidity({pool:{...n,current_sqrt_price:a==null?void 0:a.current_sqrt_price},position:f,roundUp:!1});console.log(k,"##amountInfo");const b=k.coinaAmount,N=k.coinbAmount,h=b,M=N,x=n.coinA.decimals,R=n.coinB.decimals,d=c.TickMath.tickIndexToPrice(Number(m),x,R).toString(),s=c.TickMath.tickIndexToPrice(Number(_),x,R).toString(),S=b>0?new e(o).mul(new e(b)).toNumber():0,g=N>0?new e(l).mul(new e(N)).toNumber():0,P=S>0&&S<.01?"<$0.01":`$${yo(O(S,2))}`,j=g>0&&g<.01?"<$0.01":`$${yo(O(g,2))}`,$=wo.sqrtPriceX64ToPrice(a.current_sqrt_price,x,R),q=await c.getCoinAmountFromLiquidity({pool:{...n,tick_lower_index:m,tick_upper_index:_,current_sqrt_price:a==null?void 0:a.current_sqrt_price},position:{...f,liquidity:n.liquidity},roundUp:!1}),v=new e(q.coinaAmount).toNumber(),K=new e(q.coinbAmount).toNumber();console.log(v,K,$.toString(),"###116");const y=O(new e(v).mul(new e(o)).toNumber(),2),Q=O(new e(K).mul(new e(l)).toNumber(),2);console.log(a,"newPool##"),console.log(v,K,o,l,Number(y)+Number(Q),"###poolCoinBNum");const{ratioA:F,ratioB:C}=eo.calculateDepositRatio(m,_,new H.BN(a==null?void 0:a.current_sqrt_price));console.log(F,C.toString(),"###139");const G=F.mul(100).toNumber().toFixed(0),oo=100-Number(G);console.log(v,K,G,oo,"###147");let W=0;Number(L)>0&&(W=new e(L).div(Math.pow(10,E.decimals)));const Y=new e(S).add(new e(g)).toNumber(),Z=o&&l?Y>0&&Y<.01?"<0.01":O(new e(S).add(new e(g)).toString(),2):"--",J=z.total_supply;let V=0;W>0&&J>0&&(V=new e(W).mul(Math.pow(10,E.decimals)).div(new e(J)).mul(100).toNumber()),console.log(V,"##myShare");const io=new e(1).div(Math.pow(10,n.decimals)).toNumber();let X=0;if(V>1)X=O(V,2);else if(V>0&&V<io)X=`<${io}`;else if(V==0)X=0;else{const go=fo(V),To=go==-1?2:go+2;X=O(V,To)}console.log(L,W.toString(),"###balance");const no=(await c.getTokenListByCoinType([n.quota_based_type]))[0],co=po(n.max_quota,no.decimals);console.log(n.quota_based_type,no,co,"##quoteCoinInfo");const uo=no.address==n.coin_b_address,ro=uo?new e(q.coinaAmount).mul(n.price).add(q.coinbAmount):new e(q.coinaAmount).mul(1/n.price).add(q.coinbAmount),mo=((I=r[no.address])==null?void 0:I.price)||0,so=ro.mul(new e(mo)).toNumber();console.log(uo,so,"#isQuotaCoin");const lo=co,_o=uo?new e(q.coinaAmount).mul(n.price).add(q.coinbAmount):new e(q.coinaAmount).mul(1/n.price).add(q.coinbAmount),ao=new e(lo).sub(_o).mul(l).toNumber();console.log(ao,"remainingTokenUSD##"),console.log(ro.toNumber(),"#poolTokenNum"),this.positionInfoObj[n.id]={tick_lower_index:m,tick_upper_index:_,current_sqrt_price:a.current_sqrt_price,myLiquidity:po(L,E.decimals),amountA:h,amountB:M,...n,lpInfo:E,myAmountAUSD:P,myAmountBUSD:j,myLiquidityUSD:Z,myShare:X,minPrice:d,maxPrice:s,poolCoinARatio:G,poolCoinBRatio:oo,poolCoinANum:v,poolCoinBNum:K,poolCoinAUSD:y,poolCoinBUSD:Q,quoteUSD:lo,poolUSD:so,balance:L,quoteCoinInfo:no,remainingTokenUSD:ao,currentDeposit:so,positionLiquidity:B,total_supply:z.total_supply},u.push({tick_lower_index:m,tick_upper_index:_,current_sqrt_price:(p=n==null?void 0:n.object)==null?void 0:p.current_sqrt_price,myLiquidity:po(L,E.decimals),amountA:h,amountB:M,...n,lpInfo:E,myAmountAUSD:P,myAmountBUSD:j,myLiquidityUSD:Z,myShare:X,minPrice:d,maxPrice:s,poolCoinARatio:G,poolCoinBRatio:oo,poolCoinANum:v,poolCoinBNum:K,poolCoinAUSD:y,poolCoinBUSD:Q,quoteUSD:lo,poolUSD:so,balance:L,total_supply:z.total_supply})}this.positionInfoList=u,this.autoPoolLoading=!1,console.log(this.positionInfoObj,"this.positionInfoObj###"),console.log(this.positionInfoList,"###this.positionInfoList")},async updatePositionItem(i){var co,uo,ro,mo,so,lo,_o;const A=Ao("Sui"),T=qo("Sui"),c=await A.getAutoPool(i);console.log("ðŸš€ðŸš€ðŸš€ ~ file: autoPool.ts:318 ~ updatePositionItem ~ newPoolInfo:",c);const u=await T.getPool(c.address||c.position.clmm_pool_id);console.log("newPoolInfo:",c),console.log("newPool:",u),console.log("this.positionInfoObj[id]:",this.positionInfoObj[i]);const r={...this.positionInfoObj[i],autoPoolPositionInfo:c.position,...u},U=await A.getLpBalance(r.lp_token_type);console.log(U,"updatePositionItem lp balance");const D=(await T.getTokenListByCoinType([r.lp_token_type]))[0];console.log(U,"###balance updatePositionItem");const I=r.autoPoolPositionInfo.tick_lower_index,p=r.autoPoolPositionInfo.tick_upper_index;let t;c.total_supply==0?t=0:t=eo.get_share_liquidity_by_amount(c,String(U)),console.log(t,"##liquidity");const n={tick_lower_index:I,tick_upper_index:p,current_sqrt_price:u.current_sqrt_price,liquidity:t},a=T.getCoinAmountFromLiquidity({pool:{current_sqrt_price:u.current_sqrt_price,...r},position:n,roundUp:!1}),z=a.coinaAmount,L=a.coinbAmount,{RATES:E}=this.getPoolStore,o=c.total_supply,l=wo.sqrtPriceX64ToPrice(u.current_sqrt_price,(co=r==null?void 0:r.coinA)==null?void 0:co.decimals,(uo=r==null?void 0:r.coinB)==null?void 0:uo.decimals),m=2,_=2,B=((mo=E[(ro=r==null?void 0:r.coinA)==null?void 0:ro.address])==null?void 0:mo.price)||0,f=((lo=E[(so=r==null?void 0:r.coinB)==null?void 0:so.address])==null?void 0:lo.price)||0,k=(a==null?void 0:a.coinaAmount)>0?new e(B).mul(new e(a==null?void 0:a.coinaAmount)).toNumber():0,b=(a==null?void 0:a.coinbAmount)>0?new e(f).mul(new e(a==null?void 0:a.coinbAmount)).toNumber():0,N=k>0&&k<.01?"<$0.01":`$${yo(O(k,2))}`,h=b>0&&b<.01?"<$0.01":`$${yo(O(b,2))}`;let M=new e(0);Number(U)>0&&(M=new e(U).div(Math.pow(10,D==null?void 0:D.decimals)),console.log("ðŸš€ðŸš€ðŸš€ ~ file: autoPool.ts:379 ~ updatePositionItem ~ myLiquidity:",M.toString()));const x=new e(k).add(new e(b)).toNumber(),R=B&&f?x>0&&x<.01?"<0.01":O(new e(k).add(new e(b)).toString(),2):"--";let d=0;M.toNumber()>0&&o>0&&(d=new e(M).mul(Math.pow(10,D.decimals)).div(new e(o)).mul(100).toNumber()),console.log(d,"##myShare");const s=new e(1).div(Math.pow(10,r.decimals)).toNumber();let S=0;if(d>1)S=O(d,2);else if(d>0&&d<s)S=`<${s}`;else if(d==0)S=0;else{const ao=fo(d),go=ao==-1?2:ao+2;S=O(d,go)}const g=wo.sqrtPriceX64ToPrice(u.current_sqrt_price,m,_),P=await T.getCoinAmountFromLiquidity({pool:{...r,tick_lower_index:I,tick_upper_index:p,current_sqrt_price:u==null?void 0:u.current_sqrt_price},position:{...n,liquidity:c.liquidity},roundUp:!1}),j=new e(P.coinaAmount).toNumber(),$=new e(P.coinbAmount).toNumber();console.log(j,$,g.toString(),"###116");const q=O(new e(j).mul(new e(B)).toNumber(),2),v=O(new e($).mul(new e(f)).toNumber(),2);console.log(u,"newPool##"),console.log(j,$,B,f,Number(q)+Number(v),"###poolCoinBNum");const{ratioA:K,ratioB:y}=eo.calculateDepositRatio(I,p,new H.BN(u==null?void 0:u.current_sqrt_price));console.log(K,y.toString(),"###139");const Q=K.mul(100).toNumber().toFixed(0),F=100-Number(Q),C=(await T.getTokenListByCoinType([c.quota_based_type]))[0],G=po(c.max_quota,C.decimals);console.log(c.quota_based_type,C,G,"##quoteCoinInfo");const oo=C.address==r.coin_b_address,W=oo?new e(P.coinaAmount).mul(r.price).add(P.coinbAmount):new e(P.coinaAmount).mul(1/r.price).add(P.coinbAmount),Y=((_o=E[C.address])==null?void 0:_o.price)||0,Z=W.mul(new e(Y)).toNumber(),J=G,V=oo?new e(P.coinaAmount).mul(r.price).add(P.coinbAmount):new e(P.coinaAmount).mul(1/r.price).add(P.coinbAmount),io=new e(J).sub(V).mul(f).toNumber();console.log(io,"remainingTokenUSD##");const X=T.TickMath.tickIndexToPrice(Number(I),m,_).toString(),no=T.TickMath.tickIndexToPrice(Number(p),m,_).toString();this.positionInfoObj[i]={...r,tick_lower_index:I,tick_upper_index:p,current_sqrt_price:u.current_sqrt_price,myLiquidity:po(U,D==null?void 0:D.decimals),amountA:z,amountB:L,myShare:S,myAmountAUSD:N,myAmountBUSD:h,myLiquidityUSD:R,poolCoinARatio:Q,poolCoinBRatio:F,poolCoinANum:j,poolCoinBNum:$,poolCoinAUSD:q,poolCoinBUSD:v,quoteUSD:J,balance:U,price:l,quoteCoinInfo:C,remainingTokenUSD:io,currentDeposit:Z,poolUSD:Z,positionLiquidity:t,liquidity:c==null?void 0:c.liquidity,minPrice:X,maxPrice:no,total_supply:c.total_supply},this.autoPoolLoading=!1,console.log(this.positionInfoObj[i],"###this.positionInfoObj[id]")},async getAutoPoolAPY(){try{const{data:i}=await fetch(`${w.Sui.api}/v2/sui/auto_pools`).then(A=>A.json());i&&i.pools&&i.pools.length>0&&(this.apyObj=Object.fromEntries(i.pools.map((A,T)=>[A.object_id,{...A,apr:A.apr.replace("%","")>0&&A.apr.replace("%","")<.01?"<0.01%":O(A.apr.replace("%",""),2)+"%",resultApr:A.apr.replace("%","")}])),console.log(this.apyObj,"data##"))}catch{this.apyObj={}}},async getVault(i,A){const T=Ao("Sui");A||(this.autoPoolLoading=!0);const{status:c}=await T.getVault(i);this.currentAutoPoolStatus=c,this.updatePositionItem(i),console.log(c,"status##")},setSlippage(i){console.log(i,"slippage##"),this.slippage=i,localStorage.setItem("cetus-auto-slippage",i)},logout(){this.getMyAutoPoolPosition(),this.positionUSDObj={}}}});export{Ao as a,Ro as u};
